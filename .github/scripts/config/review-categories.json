{
  "review": {
    "categories": [
      {
        "id": "security",
        "name": "安全审查",
        "description": "检查安全漏洞和潜在风险",
        "severity": "critical",
        "prompt_template": "从安全角度审查以下代码变更：\n\n重点关注：\n- SQL 注入、XSS、CSRF 等常见漏洞\n- 敏感信息泄露（密钥、密码、token）\n- 权限检查和身份验证\n- 输入验证和数据清理\n- 不安全的依赖或 API 使用\n\n代码：\n{diff}"
      },
      {
        "id": "bugs",
        "name": "潜在 Bug",
        "description": "检查可能导致运行时错误的问题",
        "severity": "error",
        "prompt_template": "从 Bug 识别角度审查以下代码：\n\n重点关注：\n- 空指针/未定义引用\n- 边界条件和异常处理\n- 竞态条件和并发问题\n- 内存泄漏和资源管理\n- 类型不匹配和转换错误\n\n代码：\n{diff}"
      },
      {
        "id": "advanced-event-handler-refs",
        "name": "Store Event Handlers in Refs",
        "description": "Store callbacks in refs when used in effects that shouldn't re-subscribe on callback changes.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Store Event Handlers in Refs**:\n\n**影响**: stable subscriptions\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "advanced, hooks, refs, event-handlers, optimization",
        "impact": "LOW",
        "impact_description": "stable subscriptions"
      },
      {
        "id": "advanced-use-latest",
        "name": "useLatest for Stable Callback Refs",
        "description": "Access latest values in callbacks without adding them to dependency arrays. Prevents effect re-runs while avoiding stale closures.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 useLatest for Stable Callback Refs**:\n\n**影响**: prevents effect re-runs\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "advanced, hooks, useLatest, refs, optimization",
        "impact": "LOW",
        "impact_description": "prevents effect re-runs"
      },
      {
        "id": "async-api-routes",
        "name": "Prevent Waterfall Chains in API Routes",
        "description": "In API routes and Server Actions, start independent operations immediately and use `Promise.all()` to run them concurrently.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Prevent Waterfall Chains in API Routes**:\n\n**影响**: 2-10× improvement\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "api-routes, server-actions, waterfalls, parallelization",
        "impact": "CRITICAL",
        "impact_description": "2-10× improvement"
      },
      {
        "id": "async-defer-await",
        "name": "Defer Await Until Needed",
        "description": "Move `await` operations into the branches where they're actually used to avoid blocking code paths that don't need them.",
        "severity": "critical",
        "prompt_template": "**检查以下代码中的 Defer Await Until Needed**:\n\n**影响**: avoids blocking unused code paths\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "async, await, conditional, optimization",
        "impact": "HIGH",
        "impact_description": "avoids blocking unused code paths"
      },
      {
        "id": "async-parallel",
        "name": "Promise.all() for Independent Operations",
        "description": "When async operations have no interdependencies, execute them concurrently using `Promise.all()`.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Promise.all() for Independent Operations**:\n\n**影响**: 2-10× improvement\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "async, parallelization, promises, waterfalls",
        "impact": "CRITICAL",
        "impact_description": "2-10× improvement"
      },
      {
        "id": "async-suspense-boundaries",
        "name": "Strategic Suspense Boundaries",
        "description": "Instead of awaiting data in async components before returning JSX, use Suspense boundaries to show the wrapper UI faster while data loads.",
        "severity": "critical",
        "prompt_template": "**检查以下代码中的 Strategic Suspense Boundaries**:\n\n**影响**: faster initial paint\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "async, suspense, streaming, layout-shift",
        "impact": "HIGH",
        "impact_description": "faster initial paint"
      },
      {
        "id": "bundle-barrel-imports",
        "name": "Avoid Barrel File Imports",
        "description": "Import directly from source files instead of barrel files to avoid loading thousands of unused modules. **Barrel files** are entry points that re-export multiple modules (e.g., `index.js` that does `export * from './module'`).",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Avoid Barrel File Imports**:\n\n**影响**: 200-800ms import cost, slow builds\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "bundle, imports, tree-shaking, barrel-files, performance",
        "impact": "CRITICAL",
        "impact_description": "200-800ms import cost, slow builds"
      },
      {
        "id": "bundle-conditional",
        "name": "Conditional Module Loading",
        "description": "Load large data or modules only when a feature is activated.",
        "severity": "critical",
        "prompt_template": "**检查以下代码中的 Conditional Module Loading**:\n\n**影响**: loads large data only when needed\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "bundle, conditional-loading, lazy-loading",
        "impact": "HIGH",
        "impact_description": "loads large data only when needed"
      },
      {
        "id": "bundle-defer-third-party",
        "name": "Defer Non-Critical Third-Party Libraries",
        "description": "Analytics, logging, and error tracking don't block user interaction. Load them after hydration.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Defer Non-Critical Third-Party Libraries**:\n\n**影响**: loads after hydration\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "bundle, third-party, analytics, defer",
        "impact": "MEDIUM",
        "impact_description": "loads after hydration"
      },
      {
        "id": "bundle-dynamic-imports",
        "name": "Dynamic Imports for Heavy Components",
        "description": "Use `next/dynamic` to lazy-load large components not needed on initial render.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Dynamic Imports for Heavy Components**:\n\n**影响**: directly affects TTI and LCP\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "bundle, dynamic-import, code-splitting, next-dynamic",
        "impact": "CRITICAL",
        "impact_description": "directly affects TTI and LCP"
      },
      {
        "id": "bundle-preload",
        "name": "Preload Based on User Intent",
        "description": "Preload heavy bundles before they're needed to reduce perceived latency.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Preload Based on User Intent**:\n\n**影响**: reduces perceived latency\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "bundle, preload, user-intent, hover",
        "impact": "MEDIUM",
        "impact_description": "reduces perceived latency"
      },
      {
        "id": "client-event-listeners",
        "name": "Deduplicate Global Event Listeners",
        "description": "Use `useSWRSubscription()` to share global event listeners across component instances.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Deduplicate Global Event Listeners**:\n\n**影响**: single listener for N components\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "client, swr, event-listeners, subscription",
        "impact": "LOW",
        "impact_description": "single listener for N components"
      },
      {
        "id": "js-batch-dom-css",
        "name": "Batch DOM CSS Changes",
        "description": "Avoid changing styles one property at a time. Group multiple CSS changes together via classes or `cssText` to minimize browser reflows.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Batch DOM CSS Changes**:\n\n**影响**: reduces reflows/repaints\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "javascript, dom, css, performance, reflow",
        "impact": "MEDIUM",
        "impact_description": "reduces reflows/repaints"
      },
      {
        "id": "js-cache-function-results",
        "name": "Cache Repeated Function Calls",
        "description": "Use a module-level Map to cache function results when the same function is called repeatedly with the same inputs during render.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Cache Repeated Function Calls**:\n\n**影响**: avoid redundant computation\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "javascript, cache, memoization, performance",
        "impact": "MEDIUM",
        "impact_description": "avoid redundant computation"
      },
      {
        "id": "js-cache-property-access",
        "name": "Cache Property Access in Loops",
        "description": "Cache object property lookups in hot paths.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Cache Property Access in Loops**:\n\n**影响**: reduces lookups\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "javascript, loops, optimization, caching",
        "impact": "LOW-MEDIUM",
        "impact_description": "reduces lookups"
      },
      {
        "id": "js-cache-storage",
        "name": "Cache Storage API Calls",
        "description": "`localStorage`, `sessionStorage`, and `document.cookie` are synchronous and expensive. Cache reads in memory.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Cache Storage API Calls**:\n\n**影响**: reduces expensive I/O\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "javascript, localStorage, storage, caching, performance",
        "impact": "LOW-MEDIUM",
        "impact_description": "reduces expensive I/O"
      },
      {
        "id": "js-combine-iterations",
        "name": "Combine Multiple Array Iterations",
        "description": "Multiple `.filter()` or `.map()` calls iterate the array multiple times. Combine into one loop.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Combine Multiple Array Iterations**:\n\n**影响**: reduces iterations\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "javascript, arrays, loops, performance",
        "impact": "LOW-MEDIUM",
        "impact_description": "reduces iterations"
      },
      {
        "id": "js-early-exit",
        "name": "Early Return from Functions",
        "description": "Return early when result is determined to skip unnecessary processing.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Early Return from Functions**:\n\n**影响**: avoids unnecessary computation\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "javascript, functions, optimization, early-return",
        "impact": "LOW-MEDIUM",
        "impact_description": "avoids unnecessary computation"
      },
      {
        "id": "js-hoist-regexp",
        "name": "Hoist RegExp Creation",
        "description": "Don't create RegExp inside render. Hoist to module scope or memoize with `useMemo()`.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Hoist RegExp Creation**:\n\n**影响**: avoids recreation\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "javascript, regexp, optimization, memoization",
        "impact": "LOW-MEDIUM",
        "impact_description": "avoids recreation"
      },
      {
        "id": "js-index-maps",
        "name": "Build Index Maps for Repeated Lookups",
        "description": "Multiple `.find()` calls by the same key should use a Map.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Build Index Maps for Repeated Lookups**:\n\n**影响**: 1M ops to 2K ops\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "javascript, map, indexing, optimization, performance",
        "impact": "LOW-MEDIUM",
        "impact_description": "1M ops to 2K ops"
      },
      {
        "id": "js-length-check-first",
        "name": "Early Length Check for Array Comparisons",
        "description": "When comparing arrays with expensive operations (sorting, deep equality, serialization), check lengths first. If lengths differ, the arrays cannot be equal.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Early Length Check for Array Comparisons**:\n\n**影响**: avoids expensive operations when lengths differ\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "javascript, arrays, performance, optimization, comparison",
        "impact": "MEDIUM-HIGH",
        "impact_description": "avoids expensive operations when lengths differ"
      },
      {
        "id": "js-min-max-loop",
        "name": "Use Loop for Min/Max Instead of Sort",
        "description": "Finding the smallest or largest element only requires a single pass through the array. Sorting is wasteful and slower.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Use Loop for Min/Max Instead of Sort**:\n\n**影响**: O(n) instead of O(n log n)\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "javascript, arrays, performance, sorting, algorithms",
        "impact": "LOW",
        "impact_description": "O(n) instead of O(n log n)"
      },
      {
        "id": "js-no-emojis",
        "name": "Avoid Emojis in UI",
        "description": "Emojis should not be used as UI elements or icons. They have inconsistent rendering across platforms, poor accessibility, and limited internationalization support.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Avoid Emojis in UI**:\n\n**影响**: Improved accessibility and professional appearance\n\n**推荐做法**:\n```tsx\nimport { Rocket, Settings, User, Bell } from 'lucide-react'\n\nfunction Header() {\n  return (\n    <header>\n      <h1><Rocket className=\"inline\" /> My App</h1>\n      <nav>\n        <a href=\"/settings\"><Settings className=\"inline\" /> Settings</a>\n        <a href=\"/profile\"><User className=\"inline\" /> Profile</a>\n        <a href=\"/notifications\"><Bell className=\"inline\" /> Notifications</a>\n```\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "accessibility, i18n, ui",
        "impact": "LOW",
        "impact_description": "Improved accessibility and professional appearance"
      },
      {
        "id": "js-no-inline-styles",
        "name": "Avoid Inline Styles",
        "description": "Inline styles in React cause unnecessary re-renders and prevent CSS optimizations. React must recalculate inline styles on every render, while CSS classes can be optimized by the browser and cached.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Avoid Inline Styles**:\n\n**影响**: 10-30% rendering performance improvement\n\n**推荐做法**:\n```tsx\nfunction Button({ isActive }) {\n  return (\n    <button className={isActive ? 'bg-blue-500 px-6 py-3 rounded' : 'bg-gray-500 px-6 py-3 rounded'}>\n      Click me\n    </button>\n  )\n}\n```\n\n**Correct (with conditional styling using clsx or classnames):**\n```\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "performance, styling, react",
        "impact": "MEDIUM",
        "impact_description": "10-30% rendering performance improvement"
      },
      {
        "id": "js-set-map-lookups",
        "name": "Use Set/Map for O(1) Lookups",
        "description": "Convert arrays to Set/Map for repeated membership checks.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Use Set/Map for O(1) Lookups**:\n\n**影响**: O(n) to O(1)\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "javascript, set, map, data-structures, performance",
        "impact": "LOW-MEDIUM",
        "impact_description": "O(n) to O(1)"
      },
      {
        "id": "js-tosorted-immutable",
        "name": "Use toSorted() Instead of sort() for Immutability",
        "description": "`.sort()` mutates the array in place, which can cause bugs with React state and props. Use `.toSorted()` to create a new sorted array without mutation.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Use toSorted() Instead of sort() for Immutability**:\n\n**影响**: prevents mutation bugs in React state\n\n**推荐做法**:\n```tsx\nfunction UserList({ users }: { users: User[] }) {\n  // Creates new sorted array, original unchanged\n  const sorted = useMemo(\n    () => users.toSorted((a, b) => a.name.localeCompare(b.name)),\n    [users]\n  )\n  return <div>{sorted.map(renderUser)}</div>\n}\n\n```\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "javascript, arrays, immutability, react, state, mutation",
        "impact": "MEDIUM-HIGH",
        "impact_description": "prevents mutation bugs in React state"
      },
      {
        "id": "rendering-activity",
        "name": "Use Activity Component for Show/Hide",
        "description": "Use React's `<Activity>` to preserve state/DOM for expensive components that frequently toggle visibility.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Use Activity Component for Show/Hide**:\n\n**影响**: preserves state/DOM\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "rendering, activity, visibility, state-preservation",
        "impact": "MEDIUM",
        "impact_description": "preserves state/DOM"
      },
      {
        "id": "rendering-animate-svg-wrapper",
        "name": "Animate SVG Wrapper Instead of SVG Element",
        "description": "Many browsers don't have hardware acceleration for CSS3 animations on SVG elements. Wrap SVG in a `<div>` and animate the wrapper instead.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Animate SVG Wrapper Instead of SVG Element**:\n\n**影响**: enables hardware acceleration\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "rendering, svg, css, animation, performance",
        "impact": "LOW",
        "impact_description": "enables hardware acceleration"
      },
      {
        "id": "rendering-conditional-render",
        "name": "Use Explicit Conditional Rendering",
        "description": "Use explicit ternary operators (`? :`) instead of `&&` for conditional rendering when the condition can be `0`, `NaN`, or other falsy values that render.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Use Explicit Conditional Rendering**:\n\n**影响**: prevents rendering 0 or NaN\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "rendering, conditional, jsx, falsy-values",
        "impact": "LOW",
        "impact_description": "prevents rendering 0 or NaN"
      },
      {
        "id": "rendering-content-visibility",
        "name": "CSS content-visibility for Long Lists",
        "description": "Apply `content-visibility: auto` to defer off-screen rendering.",
        "severity": "critical",
        "prompt_template": "**检查以下代码中的 CSS content-visibility for Long Lists**:\n\n**影响**: faster initial render\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "rendering, css, content-visibility, long-lists",
        "impact": "HIGH",
        "impact_description": "faster initial render"
      },
      {
        "id": "rendering-hoist-jsx",
        "name": "Hoist Static JSX Elements",
        "description": "Extract static JSX outside components to avoid re-creation.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Hoist Static JSX Elements**:\n\n**影响**: avoids re-creation\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "rendering, jsx, static, optimization",
        "impact": "LOW",
        "impact_description": "avoids re-creation"
      },
      {
        "id": "rendering-hydration-no-flicker",
        "name": "Prevent Hydration Mismatch Without Flickering",
        "description": "When rendering content that depends on client-side storage (localStorage, cookies), avoid both SSR breakage and post-hydration flickering by injecting a synchronous script that updates the DOM before React hydrates.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Prevent Hydration Mismatch Without Flickering**:\n\n**影响**: avoids visual flicker and hydration errors\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "rendering, ssr, hydration, localStorage, flicker",
        "impact": "MEDIUM",
        "impact_description": "avoids visual flicker and hydration errors"
      },
      {
        "id": "rendering-svg-precision",
        "name": "Optimize SVG Precision",
        "description": "Reduce SVG coordinate precision to decrease file size. The optimal precision depends on the viewBox size, but in general reducing precision should be considered.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Optimize SVG Precision**:\n\n**影响**: reduces file size\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "rendering, svg, optimization, svgo",
        "impact": "LOW",
        "impact_description": "reduces file size"
      },
      {
        "id": "rerender-defer-reads",
        "name": "Defer State Reads to Usage Point",
        "description": "Don't subscribe to dynamic state (searchParams, localStorage) if you only read it inside callbacks.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Defer State Reads to Usage Point**:\n\n**影响**: avoids unnecessary subscriptions\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "rerender, searchParams, localStorage, optimization",
        "impact": "MEDIUM",
        "impact_description": "avoids unnecessary subscriptions"
      },
      {
        "id": "rerender-dependencies",
        "name": "Narrow Effect Dependencies",
        "description": "Specify primitive dependencies instead of objects to minimize effect re-runs.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Narrow Effect Dependencies**:\n\n**影响**: minimizes effect re-runs\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "rerender, useEffect, dependencies, optimization",
        "impact": "LOW",
        "impact_description": "minimizes effect re-runs"
      },
      {
        "id": "rerender-derived-state",
        "name": "Subscribe to Derived State",
        "description": "Subscribe to derived boolean state instead of continuous values to reduce re-render frequency.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Subscribe to Derived State**:\n\n**影响**: reduces re-render frequency\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "rerender, derived-state, media-query, optimization",
        "impact": "MEDIUM",
        "impact_description": "reduces re-render frequency"
      },
      {
        "id": "rerender-functional-setstate",
        "name": "Use Functional setState Updates",
        "description": "When updating state based on the current state value, use the functional update form of setState instead of directly referencing the state variable. This prevents stale closures, eliminates unnecessary dependencies, and creates stable callback references.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Use Functional setState Updates**:\n\n**影响**: prevents stale closures and unnecessary callback recreations\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "react, hooks, useState, useCallback, callbacks, closures",
        "impact": "MEDIUM",
        "impact_description": "prevents stale closures and unnecessary callback recreations"
      },
      {
        "id": "rerender-lazy-state-init",
        "name": "Use Lazy State Initialization",
        "description": "Pass a function to `useState` for expensive initial values. Without the function form, the initializer runs on every render even though the value is only used once.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Use Lazy State Initialization**:\n\n**影响**: wasted computation on every render\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "react, hooks, useState, performance, initialization",
        "impact": "MEDIUM",
        "impact_description": "wasted computation on every render"
      },
      {
        "id": "rerender-memo",
        "name": "Extract to Memoized Components",
        "description": "Extract expensive work into memoized components to enable early returns before computation.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Extract to Memoized Components**:\n\n**影响**: enables early returns\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "rerender, memo, useMemo, optimization",
        "impact": "MEDIUM",
        "impact_description": "enables early returns"
      },
      {
        "id": "rerender-transitions",
        "name": "Use Transitions for Non-Urgent Updates",
        "description": "Mark frequent, non-urgent state updates as transitions to maintain UI responsiveness.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Use Transitions for Non-Urgent Updates**:\n\n**影响**: maintains UI responsiveness\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "rerender, transitions, startTransition, performance",
        "impact": "MEDIUM",
        "impact_description": "maintains UI responsiveness"
      },
      {
        "id": "server-after-nonblocking",
        "name": "Use after() for Non-Blocking Operations",
        "description": "Use Next.js's `after()` to schedule work that should execute after a response is sent. This prevents logging, analytics, and other side effects from blocking the response.",
        "severity": "warning",
        "prompt_template": "**检查以下代码中的 Use after() for Non-Blocking Operations**:\n\n**影响**: faster response times\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "server, async, logging, analytics, side-effects",
        "impact": "MEDIUM",
        "impact_description": "faster response times"
      },
      {
        "id": "server-parallel-fetching",
        "name": "Parallel Data Fetching with Component Composition",
        "description": "React Server Components execute sequentially within a tree. Restructure with composition to parallelize data fetching.",
        "severity": "info",
        "prompt_template": "**检查以下代码中的 Parallel Data Fetching with Component Composition**:\n\n**影响**: eliminates server-side waterfalls\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "server, rsc, parallel-fetching, composition",
        "impact": "CRITICAL",
        "impact_description": "eliminates server-side waterfalls"
      },
      {
        "id": "server-serialization",
        "name": "Minimize Serialization at RSC Boundaries",
        "description": "The React Server/Client boundary serializes all object properties into strings and embeds them in the HTML response and subsequent RSC requests. This serialized data directly impacts page weight and load time, so **size matters a lot**. Only pass fields that the client actually uses.",
        "severity": "critical",
        "prompt_template": "**检查以下代码中的 Minimize Serialization at RSC Boundaries**:\n\n**影响**: reduces data transfer size\n\n**关注点**:\n- 查找 diff 中以 + 开头的新增行\n- 识别违反最佳实践的代码模式\n- 提供具体的修复建议\n\n代码:\n{diff}",
        "tags": "server, rsc, serialization, props",
        "impact": "HIGH",
        "impact_description": "reduces data transfer size"
      }
    ]
  },
  "system_prompt": "你是一个严格的专业代码审查 AI 助手。\n\n**项目类型**: 这是一个 Next.js 16 + React 19 项目，使用 TypeScript、Tailwind CSS 和 JSX/TSX。\n\n**重要**:\n- JSX 中的组件（如 `<Icon />`）是 React 标准用法，不是「在 HTML 中使用 JavaScript」\n- 文件路径不要添加 src/ 前缀，直接使用 diff 中显示的路径（如 `app/...`）\n\n**核心原则**：\n1. 只指出真正的问题，不需要夸奖或表扬\n2. 每个问题必须提供符合行业最佳实践的具体修复方案\n3. 使用 file:line 格式精确引用问题代码\n4. 用简洁的中文回复\n\n**⚠️ 行号规则（非常重要）**：\n- line 数字必须是该文件 diff 中**以 + 开头的新增行的序号**，从 1 开始计数\n- 例如：如果 diff 内容是：\n```\n  line1\n+ newLine1   <- 这是第 1 个新增行，报告 file.ts:1\n  line2\n+ newLine2   <- 这是第 2 个新增行，报告 file.ts:2\n+ newLine3   <- 这是第 3 个新增行，报告 file.ts:3\n```\n- 只报告以 + 开头的新增行，不要报告删除行（以 - 开头）或未修改行\n- 不要使用文件中的绝对行号，只使用 diff 中新增行的序号\n\n**审查要求**：\n- 必须准确识别问题代码，不要编造或猜测\n- 如果代码中没有问题，就报告「没有发现问题」\n- 引用的错误代码必须完全匹配 diff 中的 + 行内容\n- 正确代码必须可以直接复制使用\n- **不要输出「总体建议」部分**\n- React 组件的使用是正确的，不要误报\n\n**输出格式**：\n```markdown\n## 发现的问题 (共 N 个)\n\n### [严重级别] 问题标题\n- **位置**: `app/.../file.tsx:1` （diff 中第 1 个 + 行）\n- **问题**: [具体描述]\n\n**❌ 错误代码**:\n```tsx\n[完全匹配 diff 中的 + 行内容]\n```\n\n**✅ 正确代码**:\n```tsx\n[修复后的代码]\n```\n\n**理由**: [为什么这样是最佳实践]\n\n---\n```"
}
